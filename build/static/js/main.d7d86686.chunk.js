(this["webpackJsonpvideo-chat-roulette"]=this["webpackJsonpvideo-chat-roulette"]||[]).push([[0],{111:function(e,t){},113:function(e,t){},121:function(e,t,n){},122:function(e,t,n){},123:function(e,t,n){},125:function(e,t,n){"use strict";n.r(t);var a=n(3),i=n(2),s=n(4),o=n(5),r=n(6),c=n(0),l=n.n(c),u=n(49),d=n.n(u),m=n(62),h=function(){var e=m();return e.on("error",(function(e){return console.log("socket error:",e)})),{getId:function(){return e.id},message:function(t){e.emit("message",t)},registerChatHandler:function(t,n,a){e.on("message",t),e.on("typing",n),e.on("stop typing",a)},registerCommonHandler:function(t,n){e.on("connected",t),e.on("stranger disconnected",n)},registerPeerSignal:function(t){e.on("signal",t)},registerOnlineUsers:function(t){e.on("online",t)},unRegisterChatHandler:function(){e.off("message"),e.off("typing"),e.off("stop typing")},unRegisterCommonHandler:function(){e.off("connected"),e.off("stranger disconnected")},unRegisterPeerSignal:function(t){e.off("signal",t)},startTyping:function(t){e.emit("typing",t)},stopTyping:function(t){e.emit("stop typing",t)},startSearch:function(t){e.emit("searching",t)},stop:function(t){e.emit("stop",t)},sendSignal:function(t){e.emit("signal",t)},getOnlineUsers:function(t){e.emit("online",t)}}},g=n(1),p=n(50),f=n.n(p),v=(n(93),function(e){function t(){return Object(a.a)(this,t),Object(s.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(r.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"left"},l.a.createElement("div",{className:"buttons"},l.a.createElement("button",{className:"start",style:{backgroundColor:this.props.searching||this.props.connected?"#fd4545":"#51fd6d"},onClick:this.props.start},this.props.searching||this.props.connected?"Stop":"Start"),(this.props.connected||this.props.disconnected)&&l.a.createElement("button",{className:"next",onClick:this.props.next},l.a.createElement(f.a,null))),l.a.createElement("span",null,"connected:",l.a.createElement("div",{className:"circle",style:{backgroundColor:this.props.connected?"#51fd6d":"#fd4545"}})))}}]),t}(c.Component)),y=n(52),b=n.n(y),E=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(o.a)(t).call(this,e))).state={stream:!1},n.peer=null,n.bindProps=function(){n.peer.on("signal",n.onSignal),n.peer.on("stream",n.onStream)},n.onSignal=n.onSignal.bind(Object(g.a)(n)),n.onStream=n.onStream.bind(Object(g.a)(n)),n.remoteVideo=l.a.createRef(),n}return Object(r.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.peer=new b.a({initiator:this.props.initiator,stream:this.props.stream}),this.bindProps();var e=this.peer;this.props.client.registerPeerSignal((function(t){e.signal(t)}))}},{key:"sendSignal",value:function(e){this.peer.signal(e)}},{key:"componentWillUnmount",value:function(){this.props.client.unRegisterPeerSignal(),this.peer.destroy()}},{key:"onSignal",value:function(e){this.props.client.sendSignal({toId:this.props.toId,signal:e})}},{key:"onStream",value:function(e){this.setState({stream:!0}),"srcObject"in this.remoteVideo.current?this.remoteVideo.current.srcObject=e:this.remoteVideo.current.src=window.URL.createObjectURL(e)}},{key:"render",value:function(){return l.a.createElement("div",{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",color:"#fafafa"}},this.state.stream?l.a.createElement("video",{ref:this.remoteVideo,height:"100%",autoPlay:!0}):l.a.createElement("h1",null,"You are connected but stranger don't want you to see him"," ",l.a.createElement("span",{role:"img","aria-label":"surprised"},"\ud83d\ude22")))}}]),t}(l.a.Component),O=n(53),S=n.n(O),j=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(o.a)(t).call(this,e))).state={usersCount:0},n.getOnlineUsers=n.getOnlineUsers.bind(Object(g.a)(n)),n}return Object(r.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.getOnlineUsers(this.getOnlineUsers),this.props.registerOnlineUsers(this.getOnlineUsers)}},{key:"getOnlineUsers",value:function(e){this.setState({usersCount:e})}},{key:"renderPlaceholder",value:function(){return this.props.searching&&!this.props.disconnected?l.a.createElement("div",null,l.a.createElement("h1",null,"searching..."," ",l.a.createElement("span",{role:"img","aria-label":"thinking"},"\ud83e\udd14")," "),l.a.createElement(S.a,{className:"rotating",style:{width:"50px",height:"50px"}})):this.props.searching&&this.props.disconnected?l.a.createElement("div",null,l.a.createElement("h1",null,"Stranger disconnected"," ",l.a.createElement("span",{role:"img","aria-label":"surprised"},"\ud83d\ude26")),l.a.createElement("h3",null,"Click 'next' for continue!"," ",l.a.createElement("span",{role:"img","aria-label":"badboy"},"\ud83d\ude0e"))):this.props.searching?void 0:l.a.createElement("div",null,l.a.createElement("h1",null,"Welcome to VideoChat Roulette!"," ",l.a.createElement("span",{role:"img","aria-label":"tongue"},"\ud83d\ude1b")),l.a.createElement("h3",null,"online users: ",this.state.usersCount))}},{key:"render",value:function(){return l.a.createElement("div",{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},l.a.createElement("div",{style:{textAlign:"center",color:"#fafafa"}},this.renderPlaceholder()))}}]),t}(c.Component),k=n(55),C=n(54),I=n.n(C),U=(n(121),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(o.a)(t).call(this,e))).state={messages:[],input:"",client:n.props.client,typing:!1,toId:"",initiator:null},n.onInput=n.onInput.bind(Object(g.a)(n)),n.onSendMessage=n.onSendMessage.bind(Object(g.a)(n)),n.onMessageReceived=n.onMessageReceived.bind(Object(g.a)(n)),n.onTyping=n.onTyping.bind(Object(g.a)(n)),n.onStopTyping=n.onStopTyping.bind(Object(g.a)(n)),n.onConnected=n.onConnected.bind(Object(g.a)(n)),n.onStrangerDisconnect=n.onStrangerDisconnect.bind(Object(g.a)(n)),n.scrollChatToBottom=n.scrollChatToBottom.bind(Object(g.a)(n)),n}return Object(r.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.state.client.registerChatHandler(this.onMessageReceived,this.onTyping,this.onStopTyping),this.state.client.registerCommonHandler(this.onConnected,this.onStrangerDisconnect);var e=document.getElementById("chat");e.style.height="".concat(e.offsetHeight,"px")}},{key:"componentWillUnmount",value:function(){this.state.client.unRegisterCommonHandler(),this.state.client.unRegisterChatHandler()}},{key:"componentDidUpdate",value:function(){this.scrollChatToBottom()}},{key:"onMessageReceived",value:function(e){this.setState({messages:[].concat(Object(k.a)(this.state.messages),[e])})}},{key:"onTyping",value:function(e){this.state.typing||this.setState({typing:e})}},{key:"onStopTyping",value:function(){this.state.typing&&this.setState({typing:!1})}},{key:"onConnected",value:function(e){var t=e.toId,n=e.initiator;this.setState({toId:t,initiator:n})}},{key:"onStrangerDisconnect",value:function(){this.setState({toId:"",messages:[],input:""})}},{key:"onInput",value:function(e){var t=this;this.state.typing||this.state.client.startTyping(this.state.toId);var n=e.target.value;setTimeout((function(){n===t.state.input&&t.state.client.stopTyping(t.state.toId)}),700),this.setState({input:e.target.value})}},{key:"onSendMessage",value:function(){this.state.input&&this.state.toId&&(this.state.client.message({id:this.state.toId,msg:this.state.input}),this.setState({input:""}),this.state.client.stopTyping(this.state.toId))}},{key:"onEnterDown",value:function(e){e.preventDefault(),this.onSendMessage()}},{key:"scrollChatToBottom",value:function(){this.panel.scrollTo(0,this.panel.scrollHeight)}},{key:"renderMessage",value:function(e,t){var n=e.sender===this.state.client.getId()?"You":"Stranger";return"You"===n?l.a.createElement("li",{key:t,className:"message-wrap right"},l.a.createElement("div",{className:"message-text"},e.msg),l.a.createElement("div",{className:"message-sender"},n)):l.a.createElement("li",{key:t,className:"message-wrap"},l.a.createElement("div",{className:"message-sender"},n),l.a.createElement("div",{className:"message-text"},e.msg))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{id:"chat",className:"chat"},l.a.createElement("div",{className:"messages",ref:function(t){e.panel=t}},l.a.createElement("ul",null,this.state.messages.map((function(t,n){return e.renderMessage(t,n)})),l.a.createElement("li",{key:-1},l.a.createElement("div",{className:"typing ".concat(this.state.typing&&this.state.typing!==this.state.client.getId()?"":"hide")},l.a.createElement("span",null,"Stranger is typing"),l.a.createElement("div",{className:"is-typing"},l.a.createElement("div",{className:"o1"}),l.a.createElement("div",{className:"o2"}),l.a.createElement("div",{className:"o3"})))))),l.a.createElement("div",{className:"input"},l.a.createElement("input",{type:"text",onChange:this.onInput,value:this.state.input,onKeyPress:function(t){return"Enter"===t.key?e.onEnterDown(t):null}}),l.a.createElement("button",{onClick:function(){return e.onSendMessage()}},l.a.createElement(I.a,null))))}}]),t}(l.a.Component)),N=(n(122),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(o.a)(t).call(this,e))).state={client:n.props.client,start:!1,toId:"",initiator:null,disconnected:!1,localVideo:null},n.onConnected=n.onConnected.bind(Object(g.a)(n)),n.onStrangerDisconnect=n.onStrangerDisconnect.bind(Object(g.a)(n)),n.stream=null,n.localVideo=l.a.createRef(),n}return Object(r.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.state.client.registerCommonHandler(this.onConnected,this.onStrangerDisconnect),this.getStream()}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){this.state.client.unRegisterCommonHandler()}},{key:"onConnected",value:function(e){var t=e.toId,n=e.initiator;this.setState({toId:t,initiator:n})}},{key:"onStrangerDisconnect",value:function(){this.setState({toId:"",initiator:null}),this.state.start&&this.setState({disconnected:!0})}},{key:"clickNext",value:function(){this.setState({disconnected:!1}),this.state.client.startSearch(this.state.toId)}},{key:"toogleStart",value:function(){this.state.start?(this.state.client.stop(this.state.toId),this.setState({start:!1,toId:"",initiator:null,disconnected:!1})):(this.state.client.startSearch(),this.setState({start:!0}))}},{key:"getStream",value:function(){var e=this,t=function(t){e.setState({localVideo:!0}),e.stream=t,"srcObject"in e.localVideo.current?e.localVideo.current.srcObject=e.stream:e.localVideo.current.src=window.URL.createObjectURL(e.stream)};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,"undefined"===typeof navigator.mediaDevices.getUserMedia?navigator.getUserMedia({video:!0,audio:!0},t,(function(){return e.setState({localVideo:!1})})):navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t).catch((function(){return e.setState({localVideo:!1})}))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"main"},l.a.createElement("div",{className:"video-area"},l.a.createElement("div",{className:"video remote"},this.state.toId?l.a.createElement(E,{client:this.state.client,toId:this.state.toId,initiator:this.state.initiator,stream:this.stream}):l.a.createElement(j,{registerOnlineUsers:this.state.client.registerOnlineUsers,getOnlineUsers:this.state.client.getOnlineUsers,searching:!this.state.toId&&this.state.start,disconnected:this.state.disconnected})),l.a.createElement("div",{id:"local",className:"video local"},l.a.createElement("div",{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",color:"#fafafa"}},this.state.localVideo?l.a.createElement("video",{ref:this.localVideo,autoPlay:!0,muted:!0}):l.a.createElement("div",null,l.a.createElement("h1",null,"we can't get your camera"," ",l.a.createElement("span",{role:"img","aria-label":"surprised"},"\ud83d\ude22")),l.a.createElement("h3",null,"but you still can use this app"," ",l.a.createElement("span",{role:"img","aria-label":"surprised"},"\ud83d\ude0f")),l.a.createElement("h3",null,"or try again to give us access to your camera"))))),l.a.createElement("div",{className:"bottom-area"},l.a.createElement(v,{searching:!this.state.toId&&this.state.start,connected:!!this.state.toId,disconnected:this.state.disconnected,start:function(){return e.toogleStart()},next:function(){return e.clickNext()}}),l.a.createElement(U,{client:this.state.client})))}}]),t}(l.a.Component)),M=(n(123),function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(s.a)(this,Object(o.a)(t).call(this))).state={client:h()},e}return Object(r.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"root"},l.a.createElement(N,{client:this.state.client}))}}]),t}(l.a.Component));d.a.render(l.a.createElement(M,null),document.getElementById("root"))},57:function(e,t,n){e.exports=n(125)},90:function(e,t){},93:function(e,t,n){}},[[57,1,2]]]);
//# sourceMappingURL=main.d7d86686.chunk.js.map